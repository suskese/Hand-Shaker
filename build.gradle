plugins {
    id 'base'
}

tasks.register('copyCert') {
    doLast {
        copy {
            from 'Integrity/public.cer'
            into 'src/fabric/src/main/resources'
        }
        copy {
            from 'Integrity/public.cer'
            into 'src/paper/src/main/resources'
        }
        copy {
            from 'Integrity/public.cer'
            into 'src/velton/src/main/resources'
        }
    }
}

tasks.register('copyArtifacts') {
    def fabricProject = project(':src:fabric')
    def paperProject = project(':src:paper')
    def veltonProject = project(':src:velton')

    dependsOn fabricProject.tasks.named('assemble')
    dependsOn paperProject.tasks.named('assemble')
    dependsOn veltonProject.tasks.named('assemble')

    def fabricLibs = fabricProject.layout.buildDirectory.dir('libs')
    def paperLibs = paperProject.layout.buildDirectory.dir('libs')
    def veltonLibs = veltonProject.layout.buildDirectory.dir('libs')

    doLast {
        copy {
            from fabricLibs
            into layout.buildDirectory.dir('output')
            include '*-signed.jar'
        }
        copy {
            from paperLibs
            into layout.buildDirectory.dir('output')
        }
        copy {
            from veltonLibs
            into layout.buildDirectory.dir('output')
            include '*-signed.jar'
        }
    }
}

tasks.named('build') {
    dependsOn 'copyArtifacts'
}
